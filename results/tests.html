<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 26.14.0">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
		
		
<title>EPUB 3.3 Tests</title>
		
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
.hljs{background:0 0!important}
a abbr,h1 abbr,h2 abbr,h3 abbr,h4 abbr,h5 abbr,h6 abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
a[href].self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
h2,h3,h4,h5,h6{position:relative}
aside.example .marker>a.self-link{color:inherit}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{border:none;color:inherit;font-size:83%;height:2em;left:-1.6em;opacity:.5;position:absolute;text-align:center;text-decoration:none;top:0;transition:opacity .2s;width:2em}
h2>a.self-link::before,h3>a.self-link::before,h4>a.self-link::before,h5>a.self-link::before,h6>a.self-link::before{content:"§";display:block}
@media (max-width:767px){
dd{margin-left:0}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{left:auto;top:auto}
}
@media print{
.removeOnSave{display:none}
}
</style>
		
<link rel="stylesheet" href="css/tables.css">
		
	
<meta name="description" content="Description of the EPUB 3.3 tests.">
<link rel="canonical" href="https://www.w3.org/TR/epub-tests/">
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "group": "epub",
  "wgPublicList": "public-epub3",
  "specStatus": "base",
  "noRecTrack": true,
  "publishDate": "2021-10-09",
  "shortName": "epub-tests",
  "edDraftURI": "https://w3c.github.io/epub-tests/results/",
  "copyrightStart": "2021",
  "editors": [
    {
      "name": "Ivan Herman",
      "url": "https://www.w3.org/People/Ivan/",
      "company": "W3C",
      "w3cid": 7382,
      "orcid": "https://orcid.org/0000-0003-0782-2704",
      "companyURL": "https://www.w3.org"
    },
    {
      "name": "Dan Lazin",
      "company": "Google LLC",
      "w3cid": 130027,
      "companyURL": "https://www.google.com"
    }
  ],
  "processVersion": 2020,
  "includePermalinks": true,
  "permalinkEdge": true,
  "permalinkHide": false,
  "diffTool": "http://www.aptest.com/standards/htmldiff/htmldiff.pl",
  "github": {
    "repoURL": "https://github.com/w3c/epub-tests",
    "branch": "main"
  },
  "publishISODate": "2021-10-09T00:00:00.000Z",
  "generatedSubtitle": " 09 October 2021"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css"></head>
	<body class="h-entry informative"><div class="head">
     <h1 id="title" class="title">EPUB 3.3 Tests</h1>
    
    <h2> <time class="dt-published" datetime="2021-10-09">09 October 2021</time></h2>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/epub-tests/results/">https://w3c.github.io/epub-tests/results/</a></dd>
        <dt>History:</dt><dd>
        <a href="https://github.com/w3c/epub-tests/commits/main">Commit history</a>
      </dd>
        
        
        
        
        
        <dt>Editors:</dt>
        <dd class="editor p-author h-card vcard" data-editor-id="7382">
    <a class="u-url url p-name fn" href="https://www.w3.org/People/Ivan/">Ivan Herman</a><a class="p-name orcid" href="https://orcid.org/0000-0003-0782-2704"><svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <style>

    .st1 {
      fill: #fff;
    }
  
</style>
  <path d="M256 128c0 70.7-57.3 128-128 128S0 198.7 0 128 57.3 0 128 0s128 57.3 128 128z" fill="#a6ce39"></path>
  <path class="st1" d="M86.3 186.2H70.9V79.1h15.4v107.1zM108.9 79.1h41.6c39.6 0 57 28.3 57 53.6 0 27.5-21.5 53.6-56.8 53.6h-41.8V79.1zm15.4 93.3h24.5c34.9 0 42.9-26.5 42.9-39.7C191.7 111.2 178 93 148 93h-23.7v79.4zM88.7 56.8c0 5.5-4.5 10.1-10.1 10.1s-10.1-4.6-10.1-10.1c0-5.6 4.5-10.1 10.1-10.1s10.1 4.6 10.1 10.1z"></path>
</svg></a> (<a class="p-org org h-org" href="https://www.w3.org">W3C</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="130027">
    <span class="p-name fn">Dan Lazin</span> (<a class="p-org org h-org" href="https://www.google.com">Google LLC</a>)
  </dd>
        
        
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/epub-tests/">GitHub w3c/epub-tests</a>
        (<a href="https://github.com/w3c/epub-tests/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/epub-tests/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/epub-tests/issues/">open issues</a>)
      </dd><dd><a href="mailto:public-epub3@w3.org?subject=%5Bepub-tests%5D%20YOUR%20TOPIC%20HERE">public-epub3@w3.org</a> with subject line <kbd>[epub-tests] <em>… message topic …</em></kbd> (<a rel="discussion" href="https://lists.w3.org/Archives/Public/public-epub3">archives</a>)</dd>
        
      </dl>
    </details>
    
    
    
    <p class="copyright">
    <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©
    2021
    
    <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
    <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>,
    <a href="https://ev.buaa.edu.cn/">Beihang</a>). 
    W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive document license</a> rules
    apply.
  </p>
    <hr title="Separator for header">
  </div>
		<section id="abstract" class="introductory"><h2>Abstract</h2>
			<p>Description of the EPUB 3.3 tests.</p>
		</section>
		<section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This document is merely a <abbr title="World Wide Web Consortium">W3C</abbr>-internal
       document. It has no official standing
      of any kind and does not represent consensus of the <abbr title="World Wide Web Consortium">W3C</abbr> Membership.
    </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#sec-test-tables"><bdi class="secno">2. </bdi>Description of the Tests</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#sec-(uncategorized)-data"><bdi class="secno">2.1 </bdi>(Uncategorized)</a></li><li class="tocline"><a class="tocxref" href="#sec-content-documents-data"><bdi class="secno">2.2 </bdi>Content Documents</a></li><li class="tocline"><a class="tocxref" href="#sec-core-media types-data"><bdi class="secno">2.3 </bdi>Core Media Types</a></li><li class="tocline"><a class="tocxref" href="#sec-internationalization-data"><bdi class="secno">2.4 </bdi>Internationalization</a></li></ol></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>Acknowledgements</a></li></ol></nav>

		<section id="introduction">
			<h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2>

			<p>This document provides a short overview for each EPUB 3 test, grouped separate tables by test categories. The columns in the tables are as follows:</p>

			<ol>
				<li>The identification of each test, linked to the unzipped tests themselves in the github repository</li>
				<li>Title of the test</li>
				<li>Short description of the test</li>
				<li>References to the normative statements or sections in the EPUB 3 specification that this test is relevant to</li>
				<li>Pointer to the (consolidated) implementation status of the test in the separate <a href="index.html">implementation report file</a></li>
			</ol>


		</section>

		<section id="description-of-the-tests">
  <h2 id="sec-test-tables"><bdi class="secno">2. </bdi>Description of the Tests<a class="self-link" aria-label="§" href="#sec-test-tables"></a></h2>
  <section id="uncategorized">
    <h3 id="sec-(uncategorized)-data"><bdi class="secno">2.1 </bdi>(Uncategorized)<a class="self-link" aria-label="§" href="#sec-(uncategorized)-data"></a></h3>
    <table class="zebra">
      <colgroup>
        <col class="col_id">
        <col class="col_title">
        <col>
        <col class="col_sref">
        <col class="col_tref">
      </colgroup>
      <tbody><tr>
        <th>Id</th>
        <th>Title</th>
        <th>Description</th>
        <th>Specs</th>
        <th>Ref</th>
      </tr>
      <tr>
        <td id="find-the-package-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/find-the-package-001">find-the-package-001</a>
        </td>
        <td>Find the Package</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#find-the-package-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="find-the-package-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/find-the-package-002">find-the-package-002</a>
        </td>
        <td>Find the Package</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#find-the-package-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="fxl-viewport-crop-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/fxl-viewport-crop-001">fxl-viewport-crop-001</a>
        </td>
        <td>FXL Viewport Crop 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#fxl-viewport-crop-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="item-iri-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/item-iri-001">item-iri-001</a>
        </td>
        <td>Item IRI 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#item-iri-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="linear-reachable-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/linear-reachable-001">linear-reachable-001</a>
        </td>
        <td>Linear Reachable 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#linear-reachable-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="manifest-fallback-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/manifest-fallback-001">manifest-fallback-001</a>
        </td>
        <td>Manifest Fallback 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#manifest-fallback-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="manifest-fallback-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/manifest-fallback-002">manifest-fallback-002</a>
        </td>
        <td>Manifest Fallback 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#manifest-fallback-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="manifest-fallback-003">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/manifest-fallback-003">manifest-fallback-003</a>
        </td>
        <td>Manifest Fallback 003</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#manifest-fallback-003-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="manifest-fallback-004">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/manifest-fallback-004">manifest-fallback-004</a>
        </td>
        <td>Manifest Fallback 004</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#manifest-fallback-004-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="manifest-fallback-005">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/manifest-fallback-005">manifest-fallback-005</a>
        </td>
        <td>Manifest Fallback 005</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#manifest-fallback-005-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="navigation-access-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/navigation-access-001">navigation-access-001</a>
        </td>
        <td>Navigation Access 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#navigation-access-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="navigation-access-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/navigation-access-002">navigation-access-002</a>
        </td>
        <td>Navigation Access 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#navigation-access-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="navigation-link-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/navigation-link-001">navigation-link-001</a>
        </td>
        <td>Navigation Link 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#navigation-link-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="navigation-link-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/navigation-link-002">navigation-link-002</a>
        </td>
        <td>Navigation Link 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#navigation-link-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-creator-order-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-creator-order-001">package-creator-order-001</a>
        </td>
        <td>Package Creator Order 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-creator-order-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-ignore-unknown-meta-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-ignore-unknown-meta-001">package-ignore-unknown-meta-001</a>
        </td>
        <td>Package Ignore Unknown Meta 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-ignore-unknown-meta-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-title-display-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-title-display-001">package-title-display-001</a>
        </td>
        <td>Package Title Display 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-title-display-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-unlisted-resources-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-unlisted-resources-001">package-unlisted-resources-001</a>
        </td>
        <td>Package Unlisted Resources 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-unlisted-resources-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-version-000">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-version-000">package-version-000</a>
        </td>
        <td>Package Version Zero</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-version-000-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-whitespace-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-whitespace-001">package-whitespace-001</a>
        </td>
        <td>Package Whitespace 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-whitespace-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="publication-identifier-001A">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/publication-identifier-001A">publication-identifier-001A</a>
        </td>
        <td>Publication Identifier 001A</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#publication-identifier-001A-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="publication-identifier-001B">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/publication-identifier-001B">publication-identifier-001B</a>
        </td>
        <td>Publication Identifier 001B</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#publication-identifier-001B-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="spine-order-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/spine-order-001">spine-order-001</a>
        </td>
        <td>Spine Order 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#spine-order-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="unknown-collections-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/unknown-collections-001">unknown-collections-001</a>
        </td>
        <td>Unknown Collections 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#unknown-collections-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="unknown-properties-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/unknown-properties-001">unknown-properties-001</a>
        </td>
        <td>Unknown Properties 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#unknown-properties-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="unknown-properties-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/unknown-properties-002">unknown-properties-002</a>
        </td>
        <td>Unknown Properties 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#unknown-properties-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="viewport-css-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/viewport-css-001">viewport-css-001</a>
        </td>
        <td>Acid 2 Test</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#viewport-css-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="xml-base-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/xml-base-001">xml-base-001</a>
        </td>
        <td>XML Base 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#xml-base-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="xml-external-entities-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/xml-external-entities-001">xml-external-entities-001</a>
        </td>
        <td>XML External Entities 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#xml-external-entities-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="xml-names-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/xml-names-001">xml-names-001</a>
        </td>
        <td>XML Names 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#xml-names-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="xml-non-validating-parser-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/xml-non-validating-parser-001">xml-non-validating-parser-001</a>
        </td>
        <td>XML Non-Validating Parser 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#xml-non-validating-parser-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="xml-non-validating-parser-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/xml-non-validating-parser-002">xml-non-validating-parser-002</a>
        </td>
        <td>XML Non-Validating Parser 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#xml-non-validating-parser-002-results">❐</a>
        </td>
      </tr>
    </tbody></table>
  </section>
  <section id="content-documents">
    <h3 id="sec-content-documents-data"><bdi class="secno">2.2 </bdi>Content Documents<a class="self-link" aria-label="§" href="#sec-content-documents-data"></a></h3>
    <table class="zebra">
      <colgroup>
        <col class="col_id">
        <col class="col_title">
        <col>
        <col class="col_sref">
        <col class="col_tref">
      </colgroup>
      <tbody><tr>
        <th>Id</th>
        <th>Title</th>
        <th>Description</th>
        <th>Specs</th>
        <th>Ref</th>
      </tr>
      <tr>
        <td id="confreq-mathml-rs-behavior">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-mathml-rs-behavior">confreq-mathml-rs-behavior</a>
        </td>
        <td>Support for Presentation MathML</td>
        <td>A Presentation MathML equation is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-mathml-rs-behavior">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-mathml-rs-render">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-mathml-rs-behavior-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-epub3-svg">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-epub3-svg">confreq-rs-epub3-svg</a>
        </td>
        <td>SVG content document</td>
        <td>An SVG image is displayed as a content document (not as part of an XHTML file).</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-svg">(1) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-epub3-svg-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-epub3-xhtml">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-epub3-xhtml">confreq-rs-epub3-xhtml</a>
        </td>
        <td>XHTML content document</td>
        <td>An XHTML file is displayed as a content document.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-xhtml">(1) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-epub3-xhtml-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-svg-rs-css-embed-inc">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-svg-rs-css-embed-inc">confreq-svg-rs-css-embed-inc</a>
        </td>
        <td>CSS applied to included SVG</td>
        <td>CSS changes the color of an SVG image that is embedded in the XHTML content by inclusion.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-svg-rs-css-embed-inc">(1) </a>
        </td>
        <td>
          <a href="index.html#confreq-svg-rs-css-embed-inc-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-css-embed-ref">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-css-embed-ref">confreq-rs-css-embed-ref</a>
        </td>
        <td>CSS not applied to referenced SVG</td>
        <td>CSS does NOT change the color of an SVG image that is embedded in the XHTML content by reference.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-css-embed-ref">(1) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-css-embed-ref-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-svg-rs-embed">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-svg-rs-embed">confreq-svg-rs-embed</a>
        </td>
        <td>SVG embedded in XHTML content</td>
        <td>An SVG image is embedded in the XHTML content (as inline SVG).</td>
        <td>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-svg-rs-embed">(1) </a>
        </td>
        <td>
          <a href="index.html#confreq-svg-rs-embed-results">❐</a>
        </td>
      </tr>
    </tbody></table>
  </section>
  <section id="core-media-types">
    <h3 id="sec-core-media types-data"><bdi class="secno">2.3 </bdi>Core Media Types<a class="self-link" aria-label="§" href="#sec-core-media types-data"></a></h3>
    <table class="zebra">
      <colgroup>
        <col class="col_id">
        <col class="col_title">
        <col>
        <col class="col_sref">
        <col class="col_tref">
      </colgroup>
      <tbody><tr>
        <th>Id</th>
        <th>Title</th>
        <th>Description</th>
        <th>Specs</th>
        <th>Ref</th>
      </tr>
      <tr>
        <td id="cmt-gif">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-gif">cmt-gif</a>
        </td>
        <td>GIF image</td>
        <td>A GIF image is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-gif">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-images">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-gif-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-jpeg">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-jpeg">cmt-jpeg</a>
        </td>
        <td>JPEG image</td>
        <td>A JPEG image is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-jpeg">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-images">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-jpeg-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-mp3">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-mp3">cmt-mp3</a>
        </td>
        <td>MP3 audio</td>
        <td>An MP3 audio file is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-mp3">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-mp3-aac">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-mp3-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-mp4-aac">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-mp4-aac">cmt-mp4-aac</a>
        </td>
        <td>MP4 audio</td>
        <td>An MP4 audio file is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-cmt-mp4-aac">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-mp3-aac">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-mp4-aac-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-ogg-opus">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-ogg-opus">cmt-ogg-opus</a>
        </td>
        <td>OPUS audio</td>
        <td>An OPUS audio file is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-ogg-opus">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-mp3-aac">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-ogg-opus-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-png">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-png">cmt-png</a>
        </td>
        <td>PNG image</td>
        <td>A PNG image is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-png">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-images">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-png-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-svg">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-svg">cmt-svg</a>
        </td>
        <td>SVG image</td>
        <td>An SVG image is displayed as part of the XHTML content (as a reference, not embedded).</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-svg">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-images">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-svg-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="cmt-webp">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/cmt-webp">cmt-webp</a>
        </td>
        <td>WEBP image</td>
        <td>A WEBP image is displayed as part of the XHTML content.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#cmt-webp">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#confreq-rs-epub3-images">(2) </a>
        </td>
        <td>
          <a href="index.html#cmt-webp-results">❐</a>
        </td>
      </tr>
    </tbody></table>
  </section>
  <section id="internationalization">
    <h3 id="sec-internationalization-data"><bdi class="secno">2.4 </bdi>Internationalization<a class="self-link" aria-label="§" href="#sec-internationalization-data"></a></h3>
    <table class="zebra">
      <colgroup>
        <col class="col_id">
        <col class="col_title">
        <col>
        <col class="col_sref">
        <col class="col_tref">
      </colgroup>
      <tbody><tr>
        <th>Id</th>
        <th>Title</th>
        <th>Description</th>
        <th>Specs</th>
        <th>Ref</th>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-001">confreq-rs-pkg-dir_rtl-001</a>
        </td>
        <td>Correct 'dir=rtl' on the title</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The element's 'dir' attribute is set to 'rtl'; the title should display correctly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-002">confreq-rs-pkg-dir_rtl-002</a>
        </td>
        <td>No 'dir' on the title</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The element's 'dir' attribute is not set; the title should display incorrectly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-003">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-003">confreq-rs-pkg-dir_rtl-003</a>
        </td>
        <td>Incorrect 'dir=auto' on the title</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The element's 'dir' attribute is set to 'auto'; the title should display incorrectly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-003-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-004">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-004">confreq-rs-pkg-dir_rtl-004</a>
        </td>
        <td>Correct 'dir=rtl' on the package</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The root's 'dir' attribute is set to 'rtl'; the title should display correctly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-004-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-005">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-005">confreq-rs-pkg-dir_rtl-005</a>
        </td>
        <td>Correct 'dir=rtl' on the package, wrongly overwritten by 'dir=auto' on title</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The element's 'dir' attribute is set to 'auto', and the 'dir' attribute is set to 'rtl' on the package element; the title should display incorrectly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-005-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="confreq-rs-pkg-dir_rtl-006">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/confreq-rs-pkg-dir_rtl-006">confreq-rs-pkg-dir_rtl-006</a>
        </td>
        <td>'dir=ltr' on the package, correctly overwritten 'dir=rtl' on title</td>
        <td>The 'dc:title' element contains a text whose proper rendering requires bidi control. The element's 'dir' attribute is set to 'rtl' and the 'dir' attribute is set to 'ltr' on the 'package' element; the title should display correctly.</td>
        <td>
          <a href="https://www.w3.org/TR/epub-33/#attrdef-dir">(1) </a>
          <a href="https://www.w3.org/TR/epub-rs-33/#sec-pkg-doc-base-dir">(2) </a>
        </td>
        <td>
          <a href="index.html#confreq-rs-pkg-dir_rtl-006-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="package-creator-dir-rtl-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/package-creator-dir-rtl-001">package-creator-dir-rtl-001</a>
        </td>
        <td>Package Creator Direction RTL 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#package-creator-dir-rtl-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="page-progression-001">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/page-progression-001">page-progression-001</a>
        </td>
        <td>Page Progression 001</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#page-progression-001-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="page-progression-002">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/page-progression-002">page-progression-002</a>
        </td>
        <td>Page Progression 002</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#page-progression-002-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="page-progression-003">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/page-progression-003">page-progression-003</a>
        </td>
        <td>Page Progression 003</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#page-progression-003-results">❐</a>
        </td>
      </tr>
      <tr>
        <td id="page-progression-004">
          <a href="https://github.com/w3c/epub-tests/tree/main/tests/page-progression-004">page-progression-004</a>
        </td>
        <td>Page Progression 004</td>
        <td>(No description)</td>
        <td>n.a. </td>
        <td>
          <a href="index.html#page-progression-004-results">❐</a>
        </td>
      </tr>
    </tbody></table>
  </section>
</section>

		<section class="appendix" id="acknowledgements">
			<h2 id="a-acknowledgements"><bdi class="secno">A. </bdi>Acknowledgements<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2>

			<p>The following experts contributed to the test suite:</p>

			<ul class="creator_list">
  <li>Dan Lazin</li>
  <li>Dave Cramer</li>
  <li>Ivan Herman</li>
</ul>	
		</section>

	

<p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>